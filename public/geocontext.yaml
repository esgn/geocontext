openapi: 3.0.1
info:
  title: geocontext
  description: |-
    An **experimental** API providing spatial context for LLM.
  license:
    name: MIT
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 0.1.0

#servers:
#  - url: https://geocontext.quadtreeworld.net

externalDocs:
  description: GitHub repository
  url: https://github.com/mborne/geocontext#readme

tags:
  - name: altitude
    description: Altitude
  - name: -units
    description: Unités administratives

paths:

  /api/gpf/altitude:
    get:
      tags:
        - altitude
      summary: Provides the altitude of a location given by its longitude and latitude Géoplateforme (altimetrie service)
      description: Provides the altitude of a location given by its longitude and latitude.
      operationId: getAltitude
      parameters:
        - in: query
          name: lon
          required: true
          description: the longitude of a location
          example: 6.869433
          schema:
            type: number
        - in: query
          name: lat
          required: true
          description: the latitude of a location
          example: 45.923697
          schema:
            type: number
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AltitudeResponse'
        '400':
          description: bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestResponse'
        '500':
          description: bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /api/gpf/adminexpress:
    get:
      tags:
        - admin-units
      summary: Provides administrative units (french communes, departements, regions,...) for a location given by its longitude and latitude using Géoplateforme (WFS, ADMINEXPRESS-COG.LATEST).
      description: |
        Find the following french type of administrative units for a location given by its longitude and latitude :
          * commune 
          * canton
          * collectivite_territoriale
          * epci
          * departement
          * region 
          * arrondissement
      operationId: getAdminUnitsFromAdminExpress
      parameters:
        - in: query
          name: lon
          required: true
          description: the longitude of a location
          example: 6.869433
          schema:
            type: number
        - in: query
          name: lat
          required: true
          description: the latitude of a location
          example: 45.923697
          schema:
            type: number
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AdminUnit'

        '400':
          description: bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestResponse'
        '500':
          description: bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /api/gpf/parcellaire-express:
    get:
      tags:
        - admin-units
      summary: "Renvoie les informations cadastrales pour une position donnée par sa longitude et sa latitude à l'aide du WFS Géoplateforme (CADASTRALPARCELS.PARCELLAIRE_EXPRESS)."
      description: |
        Renvoie les types ci-après correspondant à la position :
          * commune
          * feuille
          * parcelle
          * subdivision_fiscale
      operationId: getParcellaireExpress
      parameters:
        - in: query
          name: lon
          required: true
          description: La longitude
          example: 6.869433
          schema:
            type: number
        - in: query
          name: lat
          required: true
          description: La latitude
          example: 45.923697
          schema:
            type: number
      responses:
        '200':
          description: liste des éléments parcelles trouvées
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ParcellaireExpressItem'

        '400':
          description: mauvaise requête
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestResponse'
        '500':
          description: erreur système
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          example: "An error occurred"
    BadRequestResponse:
      type: object
      properties:
        message:
          type: string
          example: "Invalid request parameters"
    AdminUnit:
      type: object
      properties:
        type:
          type: string
          description: The type of the administrative unit
          examples: [commune, departement, region]
        id:
          type: string
          description: The BDTOPO identifier
          example: COMMUNE_0000000009750652
        bbox:
          schema:
            $ref: '#/components/schemas/BoundingBox'
        nom:
          type: string
          description: The name of the administrative unit
          example: "Chamonix-Mont-Blanc"
        nom_m:
          type: string
          description: The upper case name of the administrative unit
          example: "CHAMONIX-MONT-BLANC"
        insee_com:
          type: string
          description: INSEE code of the commune
          example: "74056"
        insee_dep:
          type: string
          description: INSEE code of the departement
          example: "74"
        insee_reg:
          type: string
          description: INSEE code of the region
          example: "74"
        statut:
          type: string
          description: Status of the commune
          example: "Commune simple"
        population:
          type: number
          description: Population of the commune (not available for departement and region)
          example: 8642
        # commune specific, not documented :
        #"insee_can": "10",
        #"insee_arr": "2",
        #"siren_epci": "200023372"
    ParcellaireExpressItem:
      type: object
      properties:
        id:
          type: string
          description: The BDTOPO identifier
        type:
          type: string
          description: The type of the parcellaire express item.
          enum:
            - arrondissement
            - commune
            - feuille
            - parcelle
            - subdivision_fiscale
        bbox:
          schema:
            $ref: '#/components/schemas/BoundingBox'
        nom_com:
          type: string
          description: name of the commune
        code_dep:
          type: string
          description: INSEE code of the departement
        code_insee:
          type: string
          description: INSEE code of the commune
        feuille:
          type: integer
          minimum: 0
          description: Identifiant de la feuille cadastrale
        section:
          type: string
          description: Identifiant de la section cadastrale
        code_com:
          type: string
          description: Code cadastre de la commune.
        com_abs:
          type: string
          description: Code cadastre de la commune.
        echelle:
          type: string
          description: Code de la commune absorbée
        edition:
          type: string
          format: date
        code_arr:
          type: string
        idu:
          type: string
        numero:
          type: string
        contenance:
          type: integer
          minimum: 0
        source:
          type: string
          example: Géoplateforme (WFS, CADASTRALPARCELS.PARCELLAIRE_EXPRESS)
      required:
        - id
        - type
        - bbox
        - nom_com
        - code_dep
        - code_insee
        - source
    AltitudeResponse:
      type: object
      properties:
        lon:
          type: number
          description: The longitude of the point (input)
        lat:
          type: number
          description: The latitude of the point (input)
        altitude:
          type: number
          description: The altitude of the point (output)
    BoundingBox:
      description: "Geo-spatial bounding box."
      type: array
      items:
        type: number
      minItems: 4
      maxItems: 4
